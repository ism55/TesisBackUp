\section{Interfaz}

Para acceder al servidor, primero debe comprobarse que el dispositivo está conectado correctamente. Usando otro dispositivo que cuente con Wi-Fi puede hacerse esto rápidamente, mostrando lo indicado en la figura. 

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.5]{img/redesdisp}
	\caption{Detección de señal Wi-Fi emitida por el microcontrolador ESP-8266.}
	\label{fig:redesdisp}
\end{figure}


\subsection{Página web alojada en servidor}
La aplicación principal consta de una página web alojada en el servidor ESP-8266 a la que se puede acceder vía http://192.168.4.1:8266 que luce como se observa en la figura \ref{fig:paginacompleta}.

Al abrir la web, esta solicitará al usuario que ingrese una clave. De ser exitosa, permitirá el ingreso; en caso contrario, enviará al usuario a Google. Esto se observa en la figura \ref{fig:clave}.

\begin{figure}[H]
	\centering
	\subfigure[Solicitud de clave]{\includegraphics[scale=0.7]{img/ingreseclave}\label{fig:ingreseclave}}
	\subfigure[Clave exitosa]{\includegraphics[scale=0.7]{img/claveexitosa}\label{fig:claveexitosa}}
	\subfigure[Clave incorrecta]{\includegraphics[scale=0.7]{img/claveincorrecta}\label{fig:claveincorrecta}}
	\caption{Solicitud de clave para entrada a la página.}
	\label{fig:clave}
	
\end{figure}


\begin{figure}[H]
	\centering
	\includegraphics[scale=0.06]{img/paginacompleta}
	\caption{Página web completa.}
	\label{fig:paginacompleta}
\end{figure}

Vista en detalle, las partes de la página son:

\subsubsection{Encabezado}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.25]{img/paginaheader}
	\caption{Encabezado de página}
	\label{fig:paginaheader}
\end{figure}

En la figura \ref{fig:paginaheader} puede verse la presentación de la web, con una imagen alojada en el microcontrolador codificada en base64. 

Por otra parte, en la parte inferior puede observarse el botón 'Recargar página' que reconfigura todos los parámetros a sus valores originales, enviando esta trama al brazo robot. Es importante mencionar que cada vez que la página se recargue, esto ocurrirá.


\subsubsection{Sección de pruebas}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.4]{img/paginaprobador}
	\caption{Esquema del brazo robot y probador de trayectorias}
	\label{fig:paginaprobador}
\end{figure}

En la figura \ref{fig:paginaprobador} se observan dos elementos: Una imagen del esquema de motores, codificada en base64. Y un cuadro de texto que indica 'Probador de trayectorias'.

Este probador tiene la finalidad de probar rutinas de movimiento sencillas (sin retardos), con la idea de realizar un bosquejo rápido del movimiento que desea el usuario.

Al presionar el botón 'pulsar', toda la rutina contenida en el cuadro de texto se enviará al brazo robot.

Las rutinas deben tener la estructura siguiente:

\begin{verbatim}
q1 -65.00
q2 35.00
q3 -65.00
q4 34.83
q5 -65.01
q6 -34.65
grip on
q1 34.48
q2 -65.02
q3 34.30
q4 -65.04
q5 34.13
q6 65.05
grip off
\end{verbatim}

En estas rutinas, 'qi' es el indicador de movimiento para el motor deseado. Siendo 1, 2, 3, 4, 5 y 6 correspondientes a los motores A, B, C, D, E y F. El número siguiente es el aproximado en grados del movimiento deseado. Puede ser un número entero o un número real de dos cifras significativas. El signo indica si el movimiento es en sentido negativo o no.

\subsubsection{Movimiento en tiempo real}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.3]{img/paginamov}
	\caption{Movimiento del brazo en tiempo real}
	\label{fig:paginamov}
\end{figure}

En la figura \ref{fig:paginamov}, se observan los cursores de movimiento en tiempo real. Al accionar cualquiera de estos, el valor indicado en la casilla de la derecha cambiará y a su vez será enviado al brazo robot. Además, el usuario puede colocar manualmente un valor específico en estas casillas y seguidamente presionar el botón del motor de su selección.

Es importante mencionar que los valores presentados al cargar la página son los enviados por defecto al inicio de la carga de esta. 

En la parte inferior se encuentran los botones para la habilitación o deshabilitación de la pinza neumática.

\subsubsection{Configuración de parámetros}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.3]{img/paginaconfig}
	\caption{Configuración de parámetros generales}
	\label{fig:paginaconfig}
\end{figure}

En la figura \ref{fig:paginaconfig} pueden observarse los parámetros configurables del brazo robot. 

A la izquierda se encuentran los parámetros correspondientes a los tres controladores PID presentes en el robot. Los valores mostrados son los enviados por defecto. Sin embargo, se recomienda al usuario cambiarlos a valores óptimos para evitar oscilaciones indeseadas.

A la derecha, se encuentran los parámetros de calibración para el cálculo del valor de movimiento. Estos son los considerados en la ecuación \ref{grad2dig}, por lo tanto es importante realizar variaciones solo cuando el usuario esté completamente seguro.

Seguidamente, se observan las opciones para habilitar o deshabilitar los puentes H de los motores principales. No obstante, esto no es recomendable modificar debido a que los motores constantemente realizan movimientos en sentidos positivos y negativos.

Por último, está la opción de configuración del registro PR1, quien se encarga de seleccionar la tasa de muestreo del controlador manejado por el dsPIC. El valor mostrado es el seleccionado por defecto. Es importante mencionar que este valor solo debe ser modificado cuando se esté completamente seguro de sus consecuencias.

\subsection{Solución a posibles incovenientes}

La aplicación web contenida en la página está desarrollada en JavaScript. Concretamente, con herramientas de JS y de JQuery.

Cada navegador o browser actualizado cuenta con JavaScript. Además, cualquiera que ejecute una página web que utilice JQuery automáticamente descarga esta librería (jquery.min.js), permitiendo que pueda cargarse con mayor rapidez en la siguiente ocasión. No obstante, algunas veces esto no se guarda en la memoria por diversos motivos.

Dentro del código HTML, se hace la solicitud de

\begin{verbatim}
https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js
\end{verbatim}

Para que el browser integre esta librería debe estar previamente descargada, de lo contrario ocasionará problemas en la página y no se ejecutará correctamente. 

Un método para solucionar esta eventualidad es introducir el enlace anterior en el navegador a utilizar con conectividad a internet. El parámetro '/1/' de la cadena solicita la versión más actual disponible.

En algunos casos, esto no soluciona el problema de conexión; por lo que es necesario ajustar parámetros internos del navegador.

Si se está utilizando Google Chrome (probado con versión 76.0.3809.132) u Opera (probado con versión 63.0.3368.94) se puede acceder a la memoria caché de DNS, y así ajustar el valor por defecto. Esto se hace accediendo a la dirección:

\begin{verbatim}
chrome://net-internals/#dns
\end{verbatim}
%https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js

%chrome://net-internals/#dns

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.7]{img/problemapagina}
	\caption{Vista de chrome:// net-internals}
	\label{fig:problemapagina}
\end{figure}

En la ventana mostrada en la figura \ref{fig:problemapagina} se debe presionar el botón 'Clear host cache'.

Si el problema de conectividad persiste, es necesario eliminar los valores de cookies, caché y demás datos de navegación y repetir lo explicado al inicio de esta sección (descargar nuevamente la librería jquery.min.js).


\subsection{Aplicación Android}

Esta aplicación fue desarrollada en Android Studio versión 3.4.1 para API 27 (Android 8.1 Oreo) en lenguaje Java. 

La funcionalidad de la aplicación es comunicarse a través de un canal TCP con el servidor establecido en el ESP-8266. Allí enviará los comandos generados por el archivo de texto en el que será leído línea por línea. Esto se repetirá tantas veces como quiera el usuario.

En esta aplicación sí se permite el uso de comandos de retardo (wait). Un ejemplo es la siguiente rutina:

\begin{verbatim}
	q1 -74
	q3 -110
	wait 200
	q1 -73
	q3 -109
	wait 200
	q1 -72
	q3 -108
	wait 200
	q1 -71
	q3 -107
	wait 200
\end{verbatim}

Los comandos 'wait' deben ir acompañados de un valor numérico entero que simbolizará un retardo en milisegundos.

En la figura \ref{fig:appfrommenu} se observa la vista en miniatura desde el menú de aplicaciones.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{img/appfrommenu}
	\caption{Aplicación vista desde el menú.}
	\label{fig:appfrommenu}
\end{figure}

En la figura \ref{fig:robocomapp} se observa la interfaz de la aplicación. 

El banner muestra el nombre de esta, 'ROBOCOM'. Seguidamente, el cuerpo de esta establece un campo de texto editable con etiqueta 'Número de repeticiones. En esta opción se coloca el número de veces que desea repetirse la rutina. Al dejar el valor en '0', el programa se ejecutará una sola vez.

A un lado se encuentra la etiqueta 'Status', que indica si la comunicación fue exitosa o no. De serlo, marcará el número '200'; en caso contrario marcará '404'.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{img/robocomapp}
	\caption{Vista principal de la aplicación Android.}
	\label{fig:robocomapp}
\end{figure}

Al centro de la aplicación está el campo de texto en el que se posará el texto de la rutina. Allí pueden escribirse los comandos de movimiento y configuración directamente o desde un archivo de texto que puede ser cargado al presionar el botón 'Cargar Archivo'.

Las rutinas generadas o modificadas pueden ser guardadas en un nuevo archivo indicando el nombre y presionando la opción 'Guardar a archivo'.
\section{Montaje}

\begin{figure}[H]
	\centering
	\includegraphics[scale=1]{img/MontajeTesis}
	\caption{Esquemático de conexión entre ESP-8266 y dsPIC30F3011}
	\label{fig:montajetesis}
\end{figure}


\begin{figure}[H]
	\centering
	\includegraphics[scale=0.1]{img/fotocircuito}
	\caption{Fotografía del montaje en protoboard de la tarjeta de desarrollo.}
	\label{fig:fotocircuito}
\end{figure}



\begin{figure}[H]
	\centering
	{\includegraphics[scale=0.8]{img/100_0937}\label{fig:montaje2}}
	
	\caption{Montaje del prototipo.}
	\label{fig:montajecookie}
	
\end{figure}

