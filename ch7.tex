\section{Interfaz de la aplicación web}

Para acceder al servidor puede hacerse desde cualquier dispositivo que cuente con WiFi, primero debe comprobarse que el dispositivo está conectado correctamente. Por ejemplo, usando un computador con Windows 10 puede verse lo indicado en la figura \ref{fig:redesdisp}. 

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.4]{img/redesdisp}
	\caption[Detección de señal Wi-Fi]{Detección de señal Wi-Fi emitida por el microcontrolador ESP-8266}
	{Vista en un PC con Windows 10 64 bits.}
	\label{fig:redesdisp}
\end{figure}


\subsection{Página web alojada en servidor}
La aplicación principal consta de una página web alojada en el servidor ESP-8266 a la que se puede acceder vía http://192.168.4.1:8266 (Nota: no acceder conectado a internet) que luce como se observa en la figura \ref{fig:paginacompleta}.

Al abrir la web, esta solicitará al usuario que ingrese una clave. De ser exitosa, permitirá el ingreso; en caso contrario, enviará al usuario a Google. Esto se observa en la figura \ref{fig:clave}.

\begin{figure}[H]
	\centering
	\subfigure[Solicitud de clave]{\includegraphics[scale=0.7]{img/ingreseclave}\label{fig:ingreseclave}}
	\subfigure[Clave exitosa]{\includegraphics[scale=0.7]{img/claveexitosa}\label{fig:claveexitosa}}
	\subfigure[Clave incorrecta]{\includegraphics[scale=0.7]{img/claveincorrecta}\label{fig:claveincorrecta}}
	\caption{Solicitud de clave para entrada a la página.}
	{Vista desde Windows 10 64bits a través del navegador Google chrome.}
	\label{fig:clave}
	
\end{figure}


\begin{figure}[H]
	\centering
	\includegraphics[scale=0.09]{img/paginacompleta}
	\caption{Página web completa.}
	{Vista desde Windows 10 64bits a través del navegador Google chrome.}
	\label{fig:paginacompleta}
\end{figure}

Vista en detalle, las partes de la página son:

\subsubsection{Encabezado}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.25]{img/paginaheader}
	\caption{Encabezado de página}
	\label{fig:paginaheader}
\end{figure}

En la figura \ref{fig:paginaheader} puede verse la presentación de la web, con una imagen alojada en el microcontrolador codificada en base64. 

Por otra parte, en la parte inferior puede observarse el botón 'Recargar página' que reconfigura todos los parámetros a sus valores originales, enviando esta trama al brazo robot. Es importante mencionar que cada vez que la página se recargue, esto ocurrirá.


\subsubsection{Sección de pruebas}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.4]{img/paginaprobador}
	\caption{Esquema del brazo robot y probador de trayectorias}
	\label{fig:paginaprobador}
\end{figure}

En la figura \ref{fig:paginaprobador} se observan dos elementos: Una imagen del esquema de motores, codificada en base64. Y un cuadro de texto que indica 'Probador de trayectorias'. En esta imagen están identificados los motores mediante una letra, y estos servirán para escribir y probar los comandos según la sintaxis que será explicada posteriormente.

Este probador tiene la finalidad de probar rutinas de movimiento sencillas (sin retardos), con la idea de realizar un bosquejo rápido del movimiento que desea el usuario.

Al presionar el botón 'pulsar', toda la rutina contenida en el cuadro de texto se enviará al brazo robot.

\subsubsection{Sintaxis de comandos del programa}\label{sintaxis2}

Las rutinas deben tener la estructura siguiente:

\begin{itemize}
	\item Cada comando de movimiento constará de dos elementos: Un identificador $q_{i}$ (con i= 1,2,3,4,5,6) y un número separado por un espacio, decimal con dos cifras significativas que representará la cantidad en grados que se desea mover.
	
	\item El comando de movimiento debe formarse de la siguiente manera: <qi><espacio><sDDD.FF> donde (s) denota el signo positivo o negativo, DDD es la parte entera y FF la mantisa.
	
	\item Cada línea de comando debe incluir solo una instrucción. Para realizar dos o más instrucciones, deben generarse varias líneas separadas por un 'enter' (linefeed).
	
	\item El comando 'wait' no está implementado para la página web. Únicamente para la aplicación Android.
	
	\item El comando para habilitar la pinza es <grip><espacio><on>. Para deshabilitarla es <grip><espacio><off>
	
\end{itemize}


En estas rutinas, 'qi' es el indicador de movimiento para el motor deseado. Siendo i =1, 2, 3, 4, 5 y 6 correspondientes a los motores A, B, C, D, E y F del esquema de la figura \ref{fig:paginaprobador}. El número siguiente es el aproximado en grados del movimiento deseado. Puede ser un número entero o un número real de dos cifras significativas. El signo indica si el movimiento es en sentido negativo o no.

\subsubsection{Movimiento en tiempo real}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.3]{img/paginamov}
	\caption{Movimiento del brazo en tiempo real}
	\label{fig:paginamov}
\end{figure}

En la figura \ref{fig:paginamov}, se observan los cursores de movimiento en tiempo real. Al accionar cualquiera de estos, el valor indicado en la casilla de la derecha cambiará y a su vez será enviado al brazo robot. Además, el usuario puede colocar manualmente un valor específico en estas casillas y seguidamente presionar el botón del motor de su selección.

Es importante mencionar que los valores presentados al cargar la página son los enviados por defecto al inicio de la carga de esta. 

En la parte inferior se encuentran los botones para la habilitación o deshabilitación de la pinza neumática.

\subsubsection{Configuración de parámetros}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.3]{img/paginaconfig}
	\caption{Configuración de parámetros generales}
	\label{fig:paginaconfig}
\end{figure}

En la figura \ref{fig:paginaconfig} pueden observarse los parámetros configurables del brazo robot. 

A la izquierda se encuentran los parámetros correspondientes a los tres controladores PID presentes en el robot. Los valores mostrados son los enviados por defecto. Sin embargo, se recomienda al usuario cambiarlos a valores óptimos para evitar oscilaciones indeseadas.

A la derecha, se encuentran los parámetros de calibración para el cálculo del valor de movimiento. Estos son los considerados en la ecuación \ref{ec:convertirdigital}, por lo tanto es importante realizar variaciones solo cuando el usuario esté completamente seguro.

Seguidamente, se observan las opciones para habilitar o deshabilitar los puentes H de los motores principales. No obstante, esto no es recomendable modificar debido a que los motores constantemente realizan movimientos en sentido horario y antihorario.

Por último, está la opción de configuración del registro PR1, quien se encarga de seleccionar la tasa de muestreo del controlador manejado por el dsPIC. El valor mostrado es el seleccionado por defecto. Es importante mencionar que este valor solo debe ser modificado cuando se esté completamente seguro de sus consecuencias.

\subsection{Solución a posibles incovenientes}

La aplicación web contenida en la página está desarrollada en JavaScript. Concretamente, con herramientas de JS y de JQuery.

Cada navegador o browser actualizado cuenta con JavaScript. Además, cualquiera que ejecute una página web que utilice JQuery automáticamente descarga esta librería (jquery.min.js), permitiendo que pueda cargarse con mayor rapidez en la siguiente ocasión. No obstante, algunas veces esto no se guarda en la memoria por diversos motivos.

Dentro del código HTML, se hace la solicitud de

\begin{verbatim}
https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js
\end{verbatim}

Para que el browser integre esta librería debe estar previamente descargada, de lo contrario ocasionará problemas en la página y no se ejecutará correctamente. 

Un método para solucionar esta eventualidad es introducir el enlace anterior en el navegador a utilizar con conectividad a internet. El parámetro '/1/' de la cadena solicita la versión más actual disponible.

En algunos casos, esto no soluciona el problema de conexión; por lo que es necesario ajustar parámetros internos del navegador.

Si se está utilizando Google Chrome (probado con versión 76.0.3809.132) u Opera (probado con versión 63.0.3368.94) se puede acceder a la memoria caché de DNS, y así ajustar el valor por defecto. Esto se hace accediendo a la dirección:

\begin{verbatim}
chrome://net-internals/#dns
\end{verbatim}
%https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js

%chrome://net-internals/#dns

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.7]{img/problemapagina}
	\caption{Vista de chrome:// net-internals}
	\label{fig:problemapagina}
\end{figure}

En la ventana mostrada en la figura \ref{fig:problemapagina} se debe presionar el botón 'Clear host cache'.

Si el problema de conectividad persiste, es necesario eliminar los valores de cookies, caché y demás datos de navegación y repetir lo explicado al inicio de esta sección (descargar nuevamente la librería jquery.min.js).


\subsection{Aplicación Android}

Esta aplicación fue desarrollada en Android Studio versión 3.4.1 para API 27 (Android 8.1 Oreo) en lenguaje Java, como soporte a la interfaz diseñada en las secciones anteriores. 

La funcionalidad de la aplicación es comunicarse a través de un canal TCP con el servidor establecido en el ESP-8266. Esta permite leer y generar archivos con comandos de movimientos de interés para la programación de trayectorias.  Por medio del canal TCP se enviarán los comandos generados por el archivo de texto en el que será leído línea por línea. La aplicación, además, permite que el usuario seleccione la cantidad de veces que desea que esta rutina sea procesada. 

En esta aplicación sí se permite el uso de comandos de retardo (wait). No obstante, se debe tener precaución del hardware del teléfono en la que está instalada, ya que debe tener capacidad de procesamiento de tareas en segundo plano sin saturar la memoria RAM del procesador. 

Un ejemplo de la utilización de esta aplicación es la siguiente rutina:

\begin{verbatim}
	q1 -74
	q3 -110
	wait 200
	q1 -73
	q3 -109
	wait 200
	q1 -72
	q3 -108
	wait 200
	q1 -71
	q3 -107
	wait 200
\end{verbatim}

Los comandos <wait> deben ir acompañados de un valor numérico entero que simbolizará un retardo en milisegundos, a su vez separados por un espacio de la siguiente manera: <wait><espacio><cantidad>.

En la figura \ref{fig:appfrommenu} se observa la vista en miniatura desde el menú de aplicaciones.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{img/appfrommenu}
	\caption{Aplicación vista desde el menú.}
	\label{fig:appfrommenu}
\end{figure}

En la figura \ref{fig:robocomapp} se observa la interfaz de la aplicación Android. 

El banner muestra el nombre de esta, 'ROBOCOM'. Seguidamente, el cuerpo de esta establece un campo de texto editable con etiqueta 'Número de repeticiones. En esta opción se coloca el número de veces que desea repetirse la rutina. Al dejar el valor en '0', el programa se ejecutará una sola vez.

A un lado se encuentra la etiqueta 'Status', que indica si la comunicación fue exitosa o no. De serlo, marcará el número '200'; en caso contrario marcará '404'.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{img/robocomapp}
	\caption{Vista principal de la aplicación Android.}
	\label{fig:robocomapp}
\end{figure}

Al centro de la aplicación está el campo de texto en el que se posará el texto de la rutina. Allí pueden escribirse los comandos de movimiento y configuración directamente o desde un archivo de texto que puede ser cargado al presionar el botón 'Cargar Archivo'.

Las rutinas generadas o modificadas pueden ser guardadas en un nuevo archivo indicando el nombre y presionando la opción 'Guardar a archivo'.
