En este capítulo se ilustrará con mayor detalle la información sobre el brazo manipulador MA2000, tomando en cuenta la configuración original desde el software Robocom y demás detalles referentes a la trama de comunicación y el sistema de control.

\section{ACCIONES DEL SISTEMA DE CONTROL DEL BRAZO MANIPULADOR MA2000.}\label{SEC:acciones}

Este brazo manipulador cuenta con seis grados de libertad, siendo tres correspondientes al hombro (A), codo (B) y muñeca (C), controlados con motores DC. Los grados restantes (D, E, F), son los correspondientes a la mano, y son controlados mediante servomotores. Cuenta también con una pinza neumática (pinza) como herramienta final de control. Esto se observa en las figuras \ref{fig:esquemabrazo}.\\

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.3]{img/esquemabrazo}
	\caption{Esquema de indentificación de los motores del brazo y la pinza neumática.}
	\label{fig:esquemabrazo}
\end{figure}

%\begin{figure}[H]
%	\centering
%	\includegraphics[scale=0.3]{img/brazofoto}
%	\caption{Detalle de pinza neumática}
%	\label{fig:brazofoto}
%\end{figure}

\subsubsection{Limitaciones de movimiento}

Los motores del brazo manipulador MA2000, identificados como A, B, C, D, E y F en la figura \ref{fig:esquemabrazo}, tienen limitaciones físicas que impiden que tenga una total libertad de movimiento. Esto conlleva a que el sistema controlador del brazo deba evitar que los motores hagan un esfuerzo mayor al permitido limitando estos movimientos según las condiciones de cada motor. pudiendo disminuir la posibilidad de daños a la integridad del equipo para garantizar una mejor funcionalidad del sistema.

En las figuras \ref{fig:maximoA}, \ref{fig:maximoB} y \ref{fig:maximoC} se puede observar que para los motores  A, B y C, se tienen aproximadamente 270° de movilidad en torno a sus ejes centrales.

%Con respecto a cada grado de libertad, se tienen fijados los límites de movilidad de 270° para los motores A, B y C y 120° para los motores D, E y F. Esto para evitar daños a la integridad del equipo (enredo de cables o exigir un exceso de potencia a los motores) y cualquier inconveniente que altere la funcionalidad del mismo.

%\begin{figure}[H]
%	\centering
%	\subfigure[scale=0.1]{img/q1_grado_0}
%	\caption{Motor A en posición de 0°}
%	\label{fig:q1grado0}
%\end{figure}


\begin{figure}[H]
		\begin{minipage}[c]{0.3\textwidth}
			\centering
			\includegraphics[scale=0.11]{img/q1_grado_0}
			(a) 0°
	\end{minipage}
	\hfill 	
		\begin{minipage}[c]{0.3\textwidth}
			\centering
			\includegraphics[scale=0.11]{img/q1_grado_+135}
			(b) 135°
	\end{minipage}
	\hfill	
		\begin{minipage}[c]{0.3\textwidth}
			\centering
			\includegraphics[scale=0.11]{img/q1_grado_-135}
			(c) -135°
	\end{minipage}
	\caption{Límites máximos de movimiento para el motor A.}
	\label{fig:maximoA}
\end{figure}


\begin{figure}[H]
	\begin{minipage}[c]{0.3\textwidth}
		\centering
		\includegraphics[scale=0.15]{img/q2_grado_0}
		(a) 0°
	\end{minipage}
	\hfill 	
	\begin{minipage}[c]{0.3\textwidth}
		\centering
		\includegraphics[scale=0.15]{img/q2_grado_+135}
		(b) 135°
	\end{minipage}
	\hfill	
	\begin{minipage}[c]{0.3\textwidth}
		\centering
		\includegraphics[scale=0.15]{img/q2_grado_-135}
		(c) -135°
	\end{minipage}
	\caption{Límites máximos de movimiento para el motor B.}
	\label{fig:maximoB}
\end{figure}


\begin{figure}[H]
	\begin{minipage}[c]{0.3\textwidth}
		\centering
		\includegraphics[scale=0.15]{img/q3_grado_0}
		(a) 0°
	\end{minipage}
	\hfill 	
	\begin{minipage}[c]{0.3\textwidth}
		\centering
		\includegraphics[scale=0.15]{img/q3_grado_+135}
		(b) 135°
	\end{minipage}
	\hfill	
	\begin{minipage}[c]{0.3\textwidth}
		\centering
		\includegraphics[scale=0.15]{img/q3_grado_-135}
		(c) -135°
	\end{minipage}
	\caption{Límites máximos de movimiento para el motor C.}
	\label{fig:maximoC}
\end{figure}

En las figuras \ref{fig:maximoD}, \ref{fig:maximoE} y \ref{fig:maximoF} se puede observar que para los motores D, E y F, se tienen aproximadamente 120° de movilidad en torno a sus ejes centrales.

\begin{figure}[H]
	\noindent\begin{minipage}[c]{0.3\textwidth}
		\centering
		\includegraphics[scale=0.15]{img/q4_grado_0}
		(a) 0°
	\end{minipage}%
	\hfill 	
	\begin{minipage}[c]{0.3\textwidth}
		\centering
		\includegraphics[scale=0.15]{img/q4_grado_+66}
		(b) 66°
	\end{minipage}
	\hfill	
	\begin{minipage}[c]{0.3\textwidth}
		\centering
		\includegraphics[scale=0.15]{img/q4_grado_-66}
		(c) -66°
	\end{minipage}
	\caption{Límites máximos de movimiento para el motor D.}
	\label{fig:maximoD}
\end{figure}

\begin{figure}[H]
	\begin{minipage}[c]{0.3\textwidth}
		\centering
		\includegraphics[scale=0.15]{img/q5_grado_0}
		(a) 0°
	\end{minipage}
	\hfill 	
	\begin{minipage}[c]{0.3\textwidth}
		\centering
		\includegraphics[scale=0.15]{img/q5_grado_+60}
		(b) 60°
	\end{minipage}
	\hfill	
	\begin{minipage}[c]{0.3\textwidth}
		\centering
		\includegraphics[scale=0.15]{img/q5_grado_-66}
		(c) -66°
	\end{minipage}
	\caption{Límites máximos de movimiento para el motor E.}
	\label{fig:maximoE}
\end{figure}


\begin{figure}[H]
	\begin{minipage}[c]{0.3\textwidth}
		\centering
		\includegraphics[scale=0.20]{img/q6_grado_0}
		(a) 0°
	\end{minipage}
	\hfill 	
	\begin{minipage}[c]{0.3\textwidth}
		\centering
		\includegraphics[scale=0.20]{img/q6_grado_+66}
		(b) 66°
	\end{minipage}
	\hfill	
	\begin{minipage}[c]{0.3\textwidth}
		\centering
		\includegraphics[scale=0.20]{img/q6_grado_-66}
		(c) -66°
	\end{minipage}
	\caption{Límites máximos de movimiento para el motor F.}
	\label{fig:maximoF}
\end{figure}

En la figura \ref{fig:diagramajuan2} se puede observar el diagrama de bloques que comprende detalladamente cada una de las partes del sistema del brazo manipulador MA2000. En esta se puede apreciar la unidad controladora principal apoyada por el microcontrolador dsPIC30F3011, quien procesa la trama de comunicación para accionar a los actuadores de cada motor.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{img/diagramajuan}
	\caption{Estructura del sistema de control de brazo MA 2000.}
	\label{fig:diagramajuan2}
\end{figure}



En la figura \ref{fig:dspic} puede observarse con detalle la tarjeta del controlador principal del brazo robot, quien actúa como servidor recibiendo vía puerto serial las órdenes de control, para posteriormente realizar las correspondientes acciones indicadas en la trama de comunicación. Para ello, cuenta con un módulo convertidor de USB-Serial FTDI232 (figura \ref{fig:ftdi}) para una óptima comunicación con el computador a través de un software cliente. El controlador también puede responder el estado de cada articulación relacionada a los motores DC, leyendo las entradas analógicas conectadas a potenciómetros y engranajes que ayudan a conocer la posición del brazo y así ejecutar el control PID, tal como se indica en la figura \ref{fig:diagramajuan2}.\\

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.45]{img/dsPIC.jpg}
	\caption{Tarjeta controladora con microcontrolador dsPIC30F3011}
	\label{fig:dspic}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{img/ftdi}
	\caption{Tarjeta del convertidor USB/Serial FTDI232}
	\label{fig:ftdi}
\end{figure}


El sistema realiza una acción de control PID en tres articulaciones principales (hombro, codo y muñeca) con ayuda de los puentes H de la figura \ref{fig:actuadores}. Para esto se configuran los parámetros desde un software (cliente) y se envían al controlador en una trama de tres bytes vía puerto serial, la cual será descrita en secciones posteriores.\\

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{img/actuadores}
	\caption{Puentes H L296.}
	\label{fig:actuadores}
\end{figure}

%Las acciones de control son realizadas con ayuda de un microcontrolador dsPIC30F3011, quien actúa como servidor recibiendo vía puerto serial las órdenes de control mediante la interfaz Robocom. Este programa ajusta las constantes correspondientes a cada controlador PID para los motores DC y las instrucciones de movimiento para la pinza y los motores de aeromodelismo. También ajusta las variables de calibración para el cálculo óptimo del valor a transmitir en la trama y el periodo de muestreo utilizado en la conversión analógica-digital.\\

\section{Software Robocom}

En la sección \ref{SEC:acciones} se mencionó la utilización de un software cliente que se encarga de generar la trama de comunicación que es enviada al controlador a través del puerto serial, este programa es una interfaz gráfica de usuario desarrollada en lenguaje C++ que permite, además, configurar los parámetros de mayor importancia del robot. \\

Esta herramienta permite la posibilidad de editar las variables relacionadas al movimiento del brazo y al controlador PID (factor proporcional, factor integral y factor derivativo) para cada motor DC, correspondientes al hombro, codo y muñeca. Configura la activación o desactivación de los puentes H, el accionamiento de la pinza neumática. También puede configurar el timer del microcontrolador con el que se estima el tiempo de muestreo para la ejecución de las acciones de control. \\

\subsection{Elementos fundamentales}

A continuación, se explicarán los detalles de mayor uso contenidos en el software Robocom.

Al ejecutar el programa, se puede observar una pantalla como la expuesta en la figura \ref{fig:robocomopen}:

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.9]{img/robocom_open2}
	\caption{Vista inicial al abrir el software Robocom.}
	{1. Panel de funciones rápidas.\\
	2. Setpointer.\\
	3. Opciones de comunicación.\\
	4. Habilitar/Deshabilitar pinza neumática.\\
	5. Habilitar/Deshabilitar puentes H.\\
	6. Graficador de error de posición.\\
	}
	\label{fig:robocomopen}
\end{figure}


En el panel inferior, según se observa en la figura \ref{fig:robocommenu1}, se encuentran las configuraciones generales de comunicación, el accionamiento de la pinza neumática, la habilitación de los puentes H y un menú que corresponde a la configuración del graficador del error.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.8]{img/robocom_menu2}
	\caption{Panel inferior de Robocom}
	\label{fig:robocommenu1}
\end{figure}

En la pestaña 'Comunicación', se selecciona el puerto COM al que se conecta originalmente el controlador del brazo.

La pestaña 'Gripper' posee un botón que activa o desactiva la pinza neumática.

La pestaña 'Puentes H' permite habilitar o deshabilitar los puentes H de los motores principales.

%En la pestaña 'Configuración del gráfico' se encuentran las opciones de visualización del error. No obstante, esta funcionalidad no es estudiada en este trabajo.

Un elemento importante es el 'Setpointer', indicado en la figura \ref{fig:robocomsetpointer}. Ya que esto permite ajustar la entrada de referencia al controlador y también realizar movimientos en tiempo real con el brazo.

\begin{figure}[H]
	\centering
	\includegraphics[scale=1]{img/robocom_setpointer}
	\caption{Función 'Setpointer' del software Robocom.}
	\label{fig:robocomsetpointer}
\end{figure}

A la izquierda se observan las letras 'A,B,C,D,E,F' que corresponden a cada motor. 'A, B, C' son para los motores de mayor potencia que dan movimiento al armazón del brazo robot (hombro, codo y muñeca). El resto es para los motores de la mano (D, E, F). De igual modo, la parte central de este cuadro cuenta con barras deslizantes cuya información permite generar la trama de comunicación que es enviada al microcontrolador.

Los números que se observan en el panel 'Digital' son los utilizados para generar el segundo y tercer byte (dato) de la trama de comunicación. 

El programa realiza una conversión del número observado en digital a grados o radianes según la expresión \ref{ec:convertiragrados}:

\begin{equation}\label{ec:convertiragrados}
Valor_{grados} = (Valor_{digital}+ K_{offset})K_{pro}
\end{equation}

Donde $K_{pro}$ es una constante proporcional de calibración que es utilizada para convertir el ángulo de binario a grados, medida en grados/bits y su valor programado por defecto es 0.33 grados/bits para los tres motores principales (A, B, C). Para el caso de los motores de la mano (D, E, F), el valor es fijo y vale 0.035 grados/bits.

$ K_{offset}$ es el error de corrección de la conversión a bits y es medida en bits. Su valor inicial es 0 para los motores A y C, y 39 para el motor B. Para los motores de la mano (D, E, F), el valor es fijo y vale 5682 bits.







%timer PR1 tiempo de muestre pagina 109 del pdf de anexos





En la pestaña 'Calibración', mostrada en la figura \ref{fig:robocomcali}, puede apreciarse mejor la información sobre $ K_{offset}$ y $K_{pro}$ descritas anteriormente.

\begin{figure}[H]
	\centering
	\includegraphics[scale=1]{img/robocom_cali}
	\caption{Configuración de constantes de calibración del software Robocom}
	\label{fig:robocomcali}
\end{figure}


\subsection{Generación de la trama de comunicación}

\subsubsection{Estructura}
La estructura general de la trama enviada desde el software Robocom al sistema de control consta de tres bytes cuya estructura corresponde a la tabla \ref{TAB:estructura}. Esta trama carece de bytes que determinen el inicio o el fin de la comunicación o de algún un método de comprobación de errores en la transmisión.\\

\begin{table}[H]
	\label{TAB:estructura}

\caption{Estructura general de la trama de comunicación.}
\begin{center}
	\begin{tabular}{||c||c||c||}
	\hline 
	\rule[-1ex]{0pt}{2.5ex}  comando& dato high & dato low \\ 
	\hline
	 \rule[-1ex]{0pt}{2.5ex}  8 bits& 8 bits & 8 bits\\ 
	 \hline
\end{tabular} 
\end{center}
	
\end{table}



\subsubsection{Sintaxis de comandos de movimiento}

\begin{itemize}
	\item La trama de comunicación será de 24 bits distribuidos: 8 bits para el comando y 16 bits para el dato a transmitir, como se indica en la tabla \ref{TAB:estructura}.
	
	\item La cabecera o 'comando' de la trama puede tomar cualquier valor referido en la tabla \ref{TAB:comandocliente} en la columna 'Comando'. El valor será de 8 bits e indicará qué instrucción ejecutará el controlador.
	
	\item El dato será el valor equivalente en hexadecimal del ángulo que se desea mover y será guardado en una variable de 16 bits 'Vdigital'.
	
	\item Para los motores A, B, C este valor binario debe trasladarse el contenido de la variable 'Vdigital' 6 bits a la izquierda. Esto no se realiza para los motores D, E y F.
	
	\item Para todos los motores, se obtendrá el valor bajo (byte menos significativo) al igualar 'Vigital' a una variable de 8 bits 'Vlow'.
	
	\item Para todos los motores, se obtendrá el valor alto (byte más significativo) al trasladar el contenido de la variable 'Vdigital' 8 bits a la derecha e igualarlos a una variable de 8 bits 'Vhigh'.
	
	\item La trama final será <Comando><Vhigh><Vlow>.
\end{itemize}



\begin{table}[H]
\centering
\caption{Comandos emitidos desde el software Robocom (cliente) al brazo.}
\begin{center}
	\resizebox{13cm}{!} {
% Table generated by Excel2LaTeX from sheet 'Hoja1'
\begin{tabular}{|c|c|c|}
	\hline
	\multicolumn{ 3}{|c|}{CLIENTE} \\
	\hline
	1er byte & 2do y 3er Byte & \multicolumn{ 1}{|c|}{Descripción} \\
	
	
	Comando (8 bits) & Dato (16 bits) & \multicolumn{ 1}{|c|}{} \\
	\hline
	\multicolumn{ 1}{|c|}{} &         00 & Habilitar articulación A \\
	
	\multicolumn{ 1}{|c|}{} &         01 & Deshabilitar  articulación A \\
	
	\multicolumn{ 1}{|c|}{} &         02 & Habilitar articulación B \\
	
	\multicolumn{ 1}{|c|}{} &         03 & Deshabilitar articulación B \\
	
	\multicolumn{ 1}{|c|}{E0} &         04 & Habilitar pinza neumática \\
	
	\multicolumn{ 1}{|c|}{} &         05 & Deshabilitar pinza neumática \\
	
	\multicolumn{ 1}{|c|}{} &         06 & Habilitar articulación C \\
	
	\multicolumn{ 1}{|c|}{} &         07 & Deshabilitar articulación C \\
	
	\multicolumn{ 1}{|c|}{} &         09 & Solicitud de la posición del ADC de articulación A \\
	
	\multicolumn{ 1}{|c|}{} &         10 & Solicitud de la posición del ADC de articulación B \\
	
	\multicolumn{ 1}{|c|}{} &         11 & Solicitud de la posición del ADC de articulación C \\
	\hline
	
	F0 &       Dato & Escribir Período de muestreo \\
	\hline
	F1 &       Dato & Escribir Referencia de control de PID A (PID\_A.controlReference) \\
	\hline
	F2 &       Dato & Escribir Referencia de control de PID B (PID\_B.controlReference) \\
	\hline
	F3 &       Dato & Escribir Referencia de control de PID C (PID\_C.controlReference) \\
	\hline
	F4 &       Dato & Escribir Referencia de motor de modelismo D (OC1RS) \\
	\hline
	F5 &       Dato & Escribir Referencia de motor de modelismo E (OC2RS) \\
	\hline
	F6 &       Dato & Escribir Referencia de motor de modelismo F (OC3RS) \\
	\hline
	F7 &       Dato & Escribir término proporcional del PID A \\
	\hline
	F8 &       Dato & Escribir término proporcional del PID B \\
	\hline
	F9 &       Dato & Escribir término proporcional del PID C \\
	\hline
	FA &       Dato & Escribir término integral del PID A \\
	\hline
	FB &       Dato & Escribir término integral del PID B \\
	\hline
	FC &       Dato & Escribir término integral del PID C \\
	\hline
	FD &       Dato & Escribir término derivativo del PID A \\
	\hline
	FE &       Dato & Escribir término derivativo del PID B \\
	\hline
	FF &       Dato & Escribir término derivativo del PID C \\
	\hline
\end{tabular}
}  
\end{center}
\label{TAB:comandocliente}

\end{table}


%Al seleccionar el motor que se moverá, el software Robocom envía un comando cabecera que identifica dicho motor o comando, posteriormente la construcción del dato para los motores A, B y C es la siguiente:

%\begin{center}
%	\begin{algorithm}[H]
%			Entero de 16 bits Vdigital\;
%			Entero de 8 bits Vhigh, Vlow\;
%		\Begin{
%				//Cantidad de movimiento\;
%				Se genera un valor binario correspondiente al ángulo deseado y es almacenado en la variable Vdigital\;
%				\;
%				//La variable Vdigital es modificada\;
%				Vdigital se traslada 6 bits a la izquierda\;
%				\;
%				//Obtener bits altos\;
%				
%				Vhigh es igual al valor generado al trasladar Vdigital 8 bits a la derecha\;
%				\;
%				//Obtener bits bajos\;
%				
%				Vlow es igual a los 8 bits bajos de Vdigital\;
%
%		}%end begin	
%	\end{algorithm}
	
%\end{center}


Al ejecutar Robocom se envía una rutina por defecto para una configuración previa de la posición de cada motor. Esto se logra presionando la pestaña 'Posiciones por defecto' que se observa en la figura \ref{fig:robocomopen}(sección 1).

Al presionar la función 'Posiciones por defecto' se producirá la trama de comunicación mostrada en la figura \ref{fig:docklight}. Esto se observó con ayuda del software DockLight v2.2, que es un sniffer/monitor de puerto serial RS232 para Windows.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.65]{img/docklight}
	\caption{Vista de trama transmitida por el software Robocom al iniciar conexión.}
	\label{fig:docklight}
\end{figure}




\begin{table}[H]

	\caption{Comandos enviados al generar trama por defecto. Información obtenida con el software DockLight.}
	\label{TAB:tramadefault}
	\begin{center}
		\begin{tabular}{|c|c|}
		\hline
		TRAMA & INSTRUCCIÓN \\
		\hline
		F1 00 C0  & Motor 1 en 0,99 \\
		\hline
		F2 0B C0  & Motor 2 en 28,38 \\
		\hline
		F3 F4 40  & Motor 3 en -15,51 \\
		\hline
		F4 0E CC  & Motor 4 en -66,29 \\
		\hline
		F5 0E CC  & Motor 5 en -66,29 \\
		\hline
		F6 0E CC  & Motor 6 en -66,29 \\
		\hline
		F1 00 00  & Motor 1 en 0 \\
		\hline
		F2 18 40  & Motor 2 en 44,88 \\
		\hline
		F3 DE 00  & Motor 3 en -44,88 \\
		\hline
		F4 16 40  & Motor 4 en 0,49 \\
		\hline
		F5 16 32  & Motor 5 en 0 \\
		\hline
		F6 16 32  & Motor 6 en 0 \\
		\hline
		F0 01 F4  & PR1 en 500 \\
		\hline
	\end{tabular}  
	\end{center}
\end{table}


Para comprender los datos enviados que se muestran en la tabla \ref*{TAB:tramadefault}, se tiene una lista de comandos permitidos en la comunicación del controlador y Robocom. Esta lista se muestra en la tabla \ref{TAB:comandocliente}.

Cada dato incluido en la trama es procesado para ser enviado de forma correcta a la unidad de control. El procesado se realiza partiendo de un valor digital que luego es calculado en su equivalente en grados o radianes. 

%La construcción del dato para los motores A,B y C es la siguiente:

%\begin{equation*}
% V_{digital} = V_{digital}<<6
%\end{equation*}
%\begin{equation*}
%V_{high} = V_{digital}>>8
%\end{equation*}
%\begin{equation*}
% V_{low} = V_{digital}
%\end{equation*}
%

Para los motores A, B, C, el cálculo del equivalente en grados se realizará según la ecuación \ref{ec:convertiragrados}, considerando como valores por defecto $ K_{pro}= 0.33 $ grados/bits para cada motor y $ K_{offset} =  0$ para los motores A y C; y $ K_{offset} = 39 $ bits para el motor B. Estos valores pueden ser modificados dentro de la interfaz del programa según como lo requiera el usuario.

%\begin{equation}\label{grad2dig}
% V_{grados} = K_{pro}(V_{digital}+K_{offset})
%\end{equation} \\

%Considerando como valores por defecto $ K_{pro}= 0.33 $ [grados/bits] para cada motor y $ K_{offset} =  0$ para los motores A y C; y $ K_{offset} = 39 $[bits] para el motor B. Estos valores pueden ser modificados dentro de la interfaz del programa según como lo requiera el usuario.


%La construcción del dato para los motores D, E y F es la siguiente:
%
%\begin{equation*}
%V_{high}= V_{digital}>>8 
%\end{equation*}
%\begin{equation*}
% V_{low} = V_{digital} 
%\end{equation*}
%

En cuanto a los motores D, E, F, el cálculo del equivalente en grados se determina mediante la ecuación \ref{eq:grad2dig2}.

\begin{equation}\label{eq:grad2dig2}
 V_{grados} = 0,035(V_{digital}-5682) 
\end{equation}

%La información contenida en la cabecera y cuerpo de la trama transmitida, se construye de acuerdo a la tabla \ref{TAB:comandocliente}. % \ref{TAB:comandoservidor}.

%\begin{table}[H]
%\centering
%\caption{Comandos emitidos desde el software Robocom (cliente) al brazo.}
%\begin{center}
%	\resizebox{15cm}{!} {
%% Table generated by Excel2LaTeX from sheet 'Hoja1'
%\begin{tabular}{|c|c|c|}
%	\hline
%	\multicolumn{ 3}{|c|}{CLIENTE} \\
%	\hline
%	1er byte & 2do y 3er Byte & \multicolumn{ 1}{|c|}{Descripción} \\
%	
%	
%	Comando (8 bits) & Dato (16 bits) & \multicolumn{ 1}{|c|}{} \\
%	\hline
%	\multicolumn{ 1}{|c|}{} &         00 & Enable articulacion A \\
%	
%	\multicolumn{ 1}{|c|}{} &         01 & Disable articulacion A \\
%	
%	\multicolumn{ 1}{|c|}{} &         02 & Enable articulacion B \\
%	
%	\multicolumn{ 1}{|c|}{} &         03 & Disable articulacion B \\
%	
%	\multicolumn{ 1}{|c|}{E0} &         04 & Enable pinza neumática \\
%	
%	\multicolumn{ 1}{|c|}{} &         05 & Disable pinza neumática \\
%	
%	\multicolumn{ 1}{|c|}{} &         06 & Enable articulacion C \\
%	
%	\multicolumn{ 1}{|c|}{} &         07 & Disable articulacion C \\
%	
%	\multicolumn{ 1}{|c|}{} &         09 & Solicitud de la posición del A/D de articulación A \\
%	
%	\multicolumn{ 1}{|c|}{} &         10 & Solicitud de la posición del A/D de articulación B \\
%	
%	\multicolumn{ 1}{|c|}{} &         11 & Solicitud de la posición del A/D de articulación C \\
%	\hline
%	
%	F0 &       Dato & Escribir Periodo de muestreo \\
%	\hline
%	F1 &       Dato & Escribir Referencia de control de PID A (PID\_A.controlReference) \\
%	\hline
%	F2 &       Dato & Escribir Referencia de control de PID B (PID\_B.controlReference) \\
%	\hline
%	F3 &       Dato & Escribir Referencia de control de PID C (PID\_C.controlReference) \\
%	\hline
%	F4 &       Dato & Escribir Referencia de motor de modelismo D (OC1RS) \\
%	\hline
%	F5 &       Dato & Escribir Referencia de motor de modelismo E (OC2RS) \\
%	\hline
%	F6 &       Dato & Escribir Referencia de motor de modelismo F (OC3RS) \\
%	\hline
%	F7 &       Dato & Escribir término proporcional del PID A \\
%	\hline
%	F8 &       Dato & Escribir término proporcional del PID B \\
%	\hline
%	F9 &       Dato & Escribir término proporcional del PID C \\
%	\hline
%	FA &       Dato & Escribir término integral del PID A \\
%	\hline
%	FB &       Dato & Escribir término integral del PID B \\
%	\hline
%	FC &       Dato & Escribir término integral del PID C \\
%	\hline
%	FD &       Dato & Escribir término derivativo del PID A \\
%	\hline
%	FE &       Dato & Escribir término derivativo del PID B \\
%	\hline
%	FF &       Dato & Escribir término derivativo del PID C \\
%	\hline
%\end{tabular}
%}  
%\end{center}
%\label{TAB:comandocliente}
%
%\end{table}
%

%El controlador también puede dar respuesta a las solicitudes de posición del A/D. Los comandos emitidos por el controlador se observan en la tabla \ref{TAB:comandoservidor}. No obstante, no son objeto de estudio de este trabajo.
 
%\begin{table}[H]
%	% Table generated by Excel2LaTeX from sheet 'Hoja1'
%	
%	\caption{Comandos emitidos por el controlador (servidor) como respuesta al cliente.}
%	\begin{center}
%		\begin{tabular}{|c|c|c|}
%		\hline
%		\multicolumn{ 3}{|c|}{SERVIDOR} \\
%		\hline
%		1er byte & 2do y 3er byte & \multicolumn{ 1}{|c|}{Descripción} \\
%		
%		Comando (8bits) & Dato (16bits) & \multicolumn{ 1}{|c|}{} \\
%		\hline
%		A9 &       Dato & Valor del A/D de articulación A \\
%		\hline
%		
%		B9 &       Dato & Valor del A/D de articulación A* \\
%		\hline
%		
%		C9 &       Dato & Valor del A/D de articulación B \\
%		\hline
%		
%		D9 &       Dato & Valor del A/D de articulación B* \\
%		\hline
%		
%		E9 &       Dato & Valor del A/D de articulación C \\
%		\hline
%		
%		F9 &       Dato & Valor del A/D de articulación C* \\
%		\hline
%	\end{tabular}  
%	\end{center}
%	\label{TAB:comandoservidor}
%	
%\end{table}
%

%Considerando como valores por defecto Kpro= 0.33 [grados/bits] para cada motor y Koffset = 0 para los motores A y C; y Koffset = 39[bits] para el motor B. Estos valores pueden ser modificados dentro de la interfaz del programa según como lo requiera el usuario.
%
%Permite establecer la posición angular de cada articulación.
%2. Permite el ajuste de los parámetros proporcional integral y derivativo
%del controlador PID, así como periodo de tiempo durante el cual el
%controlador toma las muestras y ejecuta el algoritmo de control.
%3. Permite visualizar en forma simultánea el error de posición de las
%articulaciones A, B y C del manipulador en un gráfico xy.
%4. Permite la calibración del manipulador respecto al ángulo medido en
%las articulaciones A, B y C. Para realizar la calibración se emplean dos
%constantes, una de offset y otra de proporcionalidad que relacionan el
%número obtenido a partir del convertidor A/D y los potenciómetros de
%las articulaciones A, B y C del DSC con el ángulo físico medido en
%grados o radianes.
%5. Permite la resolución del problema cinemático directo a partir de las
%coordenadas articulares deseadas. Se puede obtener tanto las
%coordenadas angulares según la convención de DH como la
%orientación del efector final del manipulador. El cálculo cinemático
%directo se realiza utilizando la convención de Denavit-Hartenberg y
%matrices de transformación homogéneas. Se pueden variar los
%parámetros de Denavit-Hartenberg en caso de que se realice al
%manipulador alguna modificación geométrica.
%6. Permite la programación de trayectorias tanto mediante guiado activo
%como pasivo y el software genera un archivo de texto que puede ser
%almacenado para permitir la ejecución posterior de las trayectorias61
%programadas. Convenientemente el archivo de texto puede ser
%generado mediante otros lenguajes de programación con herramientas
%matemáticas más poderosas a partir de los cuales se puedan generar
%trayectorias, tales como Matlab y la Toolbox de robótica de Peter
%Corke o cualquier otra herramienta sin demasiados inconvenientes.
%7. Permite el accionamiento de la pinza neumática, así como activación y
%desactivación de los puentes H.


\section{Unidad de control}

El microcontrolador recibe todas las instrucciones vía puerto serial configurado con 8 bits, 1 bit de parada, 115200 baudios; y utiliza solo los pines de Rx (U2RX) y Tx(U2TX) para establecer la comunicación. Ante cada instrucción de movimiento, el microcontrolador puede emitir un total de nueve señales PWM. Para los motores A, B, C, les corresponden dos señales, una para movimiento positivo y otra para movimiento negativo, respectivamente. El resto de los motores poseen solo una señal PWM para cada uno. El diagrama de conexiones e identificación de las funciones de cada pin se puede observar en la figura \ref{fig:dspicpinout}.

\section{PWM}
En la figura \ref{fig:dspicpinout} se observan los pines de salida seleccionados para la señal PWM que controlará a los motores. En el manual anexo al trabajo de Marcano \cite{juan1} indica cuáles son las características básicas que deben poseer los registros de configuración de PWM para el microcontrolador Microchip dsPIC30F3011: 

Motores A, B, C:

Estos motores tienen configurada una señal PWM de 11 bits y frecuencia 29,328kHz. Con esta resolución de señal se puede obtener un ciclo de trabajo máximo configurando el registro de Duty Cycle (PDC) a un valor de 2048. Los pines de salida de PWM fueron configurados en modo complementario, por lo tanto para que la corriente promedio entregada al motor sea cero se configura el registro PDC=1023. Para que el motor produzca par máximo, el registro de duty cycle debe ser PDC=0 para que gire en un sentido o PDC =2048 para que gire en el otro sentido.

Motores D, E, F:

Se configuraron para un periodo de 17,3 ms. Para obtener una posición del servomotor centrada, que corresponde con un pulso 1,5 ms de duración, el registro de salida secundario debe ser igual a 5682 en decimal. Es necesario generar un pulso desde 1 ms hasta 2ms, por lo tanto, los valores válidos del registro en esta aplicación van desde el 3788 hasta el 7576 en sistema decimal, lo que permite obtener la posición deseada en dentro del rango de posiciones del servomotor.

\begin{figure}[H]
	%\centering
	\includegraphics[scale=0.65]{img/dspicpinout}
	\caption{Pines de conexión del módulo controlador original.}
	\label{fig:dspicpinout}
\end{figure}
